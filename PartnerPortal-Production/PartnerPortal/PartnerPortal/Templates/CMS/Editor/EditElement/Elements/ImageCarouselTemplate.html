<div style="width: 95%; display: inline-block; position: absolute; left: 2%;">
    <div class="clearfix form-element-container form-element-container-select">
        <div class="name-description"><strong>Frame Type</strong><span>horizontal = for horizontal carousel<br>vertical = for vertical carousel.</span></div>
        <div class="element-type">
            <div class="select_arrow"></div>
            <select id="fusion_picture_size" name="fusion_picture_size" class="select-field objectProperty" data-PropertyIndex="448">
                <option value="horizontal" selected="">Horizontal</option>
                <option value="vertical">Vertical</option>
            </select>
        </div>
    </div>
    <div class="clearfix form-element-container form-element-container-select">
        <div class="name-description"><strong>Autoplay</strong><span>Choose to autoplay the carousel.</span></div>
        <div class="element-type">
            <div class="select_arrow"></div>
            <select id="fusion_autoplay" name="fusion_autoplay" class="select-field objectProperty" data-PropertyIndex="450">
                <option value="yes">Yes</option>
                <option value="no" selected="">No</option>
            </select>
        </div>
    </div>
    <div class="clearfix form-element-container form-element-container-select">
        <div class="name-description"><strong>Maximum Columns</strong><span>Select the number of max columns to display.</span></div>
        <div class="element-type">
            <div class="select_arrow"></div>
            <select id="fusion_columns" name="fusion_columns" class="select-field objectProperty" data-PropertyIndex="451">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5" selected="">5</option>
                <option value="6">6</option>
            </select>
        </div>
    </div>
    <div class="clearfix form-element-container form-element-container-input">
        <div class="name-description"><strong>Column Spacing</strong><span>Insert the amount of spacing between items without 'px'. ex: 13.</span></div>
        <div class="element-type">
            <input type="text" class="text-field objectProperty" data-PropertyIndex="452" value="13" id="fusion_column_spacing" name="fusion_column_spacing" size="50" style="padding: 6px 0px !important;">
        </div>
    </div>
    <div class="clearfix form-element-container form-element-container-input" style="display: none;">
        <div class="name-description"><strong>Scroll Items</strong><span>Insert the amount of items to scroll. Leave empty to scroll number of visible items.</span></div>
        <div class="element-type">
            <input type="text" class="text-field objectProperty" data-PropertyIndex="453" value="" id="fusion_scroll_items" name="fusion_scroll_items" size="50" style="padding: 6px 0px !important;">
        </div>
    </div>
    <div class="clearfix form-element-container form-element-container-select" style="display: none;">
        <div class="name-description"><strong>Show Navigation</strong><span>Choose to show navigation buttons on the carousel.</span></div>
        <div class="element-type">
            <div class="select_arrow"></div>
            <select id="fusion_navigation" name="fusion_navigation" class="select-field objectProperty" data-PropertyIndex="454">
                <option value="yes" selected="">Yes</option>
                <option value="no">No</option>
            </select>
        </div>
    </div>
    <div class="clearfix form-element-container form-element-container-select" style="display: none;">
        <div class="name-description"><strong>Mouse Scroll</strong><span>Choose to enable mouse drag control on the carousel. IMPORTANT: For easy draggability, when mouse scroll is activated, links will be disabled.</span></div>
        <div class="element-type">
            <div class="select_arrow"></div>
            <select id="fusion_mouse_scroll" name="fusion_mouse_scroll" class="select-field objectProperty" data-PropertyIndex="455">
                <option value="yes">Yes</option>
                <option value="no" selected="">No</option>
            </select>
        </div>
    </div>
    <div class="clearfix form-element-container form-element-container-select">
        <div class="name-description"><strong>Border</strong><span>Choose to enable a border around the images.</span></div>
        <div class="element-type">
            <div class="select_arrow"></div>
            <select id="fusion_border" name="fusion_border" class="select-field objectProperty" data-PropertyIndex="456">
                <option value="yes" selected="">Yes</option>
                <option value="no">No</option>
            </select>
        </div>
    </div>
    <div class="clearfix form-element-container form-element-container-select" style="display: none;">
        <div class="name-description"><strong>Image lightbox</strong><span>Show image in lightbox.</span></div>
        <div class="element-type">
            <div class="select_arrow"></div>
            <select id="fusion_lightbox" name="fusion_lightbox" class="select-field objectProperty" data-PropertyIndex="457">
                <option value="yes" selected="">Yes</option>
                <option value="no">No</option>
            </select>
        </div>
    </div>
    <div class="clearfix form-element-container form-element-container-input">
        <div class="name-description"><strong>CSS Class</strong><span>Add a class to the wrapping HTML element.</span></div>
        <div class="element-type">
            <input type="text" class="text-field objectProperty" data-PropertyIndex="458" value="" id="fusion_class" name="fusion_class" size="50" style="padding: 6px 0px !important;">
        </div>
    </div>
    <div class="clearfix form-element-container form-element-container-input">
        <div class="name-description"><strong>CSS ID</strong><span>Add an ID to the wrapping HTML element.</span></div>
        <div class="element-type">
            <input type="text" class="text-field objectProperty" data-PropertyIndex="459" value="" id="fusion_id" name="fusion_id" size="50" style="padding: 6px 0px !important;">
        </div>
    </div>
    <table class="clearfix has-children" id="ImageCarouselContainer">  <!--ImageCarouselContainer-->
        <tbody>
            <tr data-boxIndex="0">
                <td><a href="#" class="fusion-expand-child linkHeader" data-boxIndex="" onclick="toggleImageCarouselDetail(this)" data-state="0">Image Carousel Item 1<i class="fusiona-plus2"></i></a>
                    <div class="child-options boxDetail" style="display: none;" data-boxIndex ="">
                        <div class="clearfix form-element-container funsion-element-child form-element-container-input">
                            <div class="name-description"><strong>Image Website Link</strong><span>Add the url to image's website. If lightbox option is enabled, you have to add the full image link to show it in the lightbox.</span></div>
                            <div class="element-type"><input type="text" class="text-field subObjectProperty" data-subPropertyIndex="68" value="" id="fusion_url[0]" name="fusion_url[0]" size="50" style="padding: 6px 0px !important;"></div>
                        </div>
                        <div class="clearfix form-element-container funsion-element-child form-element-container-select">
                            <div class="name-description"><strong>Link Target</strong><span>_self = open in same window<br>_blank = open in new window</span></div>
                            <div class="element-type">
                                <div class="select_arrow"></div>
                                <select id="fusion_target[0]" name="fusion_target[0]" class="select-field subObjectProperty" data-subPropertyIndex="69"><option value="_self" selected="">_self</option><option value="_blank">_blank</option></select>
                            </div>
                        </div>
                        <div class="clearfix form-element-container funsion-element-child form-element-container-upload">
                            <div class="name-description"><strong>Image</strong><span>Upload an image to display.</span></div>
                            <div class="element-type">
                                <div class="fusion-upload-container">
                                    <img src="" alt="Image" class="uploaded-image" style="height: 192px; width: 311px; padding-bottom: 3px;">
                                    <div style="clear: both;"></div>
                                    <input type="hidden" class="fusion-form-text fusion-form-upload fusion-input subObjectProperty" name="fusion_image" value="" data-subPropertyIndex="70">
                                    <a href="#" class="fusionb-upload-button " data-upid="1">Upload</a>
                                    <a href="#" style="display: none" class="fusionb-edit-button" data-upid="1">Edit</a>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix form-element-container funsion-element-child form-element-container-input">
                            <div class="name-description"><strong>Image Alt Text</strong><span>The alt attribute provides alternative information if an image cannot be viewed.</span></div>
                            <div class="element-type"><input type="text" class="text-field subObjectProperty" data-subPropertyIndex="71" value="" id="fusion_alt[0]" name="fusion_alt[0]" size="50" style="padding: 6px 0px !important;">
                            </div>
                        </div>
                        <a class="child-clone-row-remove fusion-shortcodes-button" href="JavaScript:void(0)" onclick="removeImageCarousel(this)">Remove</a>
                    </div>
                </td>
            </tr>
            <tr><td><a id="fusion-child-add" data-itemCount="1" href="JavaScript:void(0)" onclick="addNewImageCarousel(this)">Add New Image</a></td></tr>
        </tbody>
    </table>
</div>


<script>
    var uploaderOpenedBy = {};
    var ImageCarousel = 0;
    $(document).ready(function () {
        $(".ui-dialog").css("height", $(window).height() - 60);

        //get the object and set values
        var carrierObj = JSON.parse($("#dialog_form").attr("data-obj"));
        try {
            $(".objectProperty").each(function () {
                if ($(this).is('div')) {
                    $(this).html(carrierObj[$(this).attr("data-PropertyIndex")]);
                } else {
                    if (carrierObj[$(this).attr("data-PropertyIndex")] != null && carrierObj[$(this).attr("data-PropertyIndex")] != undefined && carrierObj[$(this).attr("data-PropertyIndex")].length > 0) {
                        $(this).val(carrierObj[$(this).attr("data-PropertyIndex")]);
                    }
                }
            });
        } catch (e) {

        }

        $("#ImageCarouselContainer tr:first").hide();
        var tempImageCarousels = carrierObj[617];
        if (tempImageCarousels != undefined && tempImageCarousels.length > 0) {
            for (var i = 0; i < tempImageCarousels.length; i++) {
                addNewImageCarousel($("#fusion-child-add"), tempImageCarousels[i]);
            }
        } else {//First Time
            addNewImageCarousel($("#fusion-child-add"));
        }
    });

    function toggleImageCarouselDetail(ctrl) {
        var state = $(ctrl).attr("data-state");
        var index = $(ctrl).attr("data-boxIndex");

        if (state == 0) {
            $(ctrl).parent().find(".boxDetail").show();
            $(ctrl).attr("data-state", "1");
            $(ctrl).html("Image Carousel Item " + index + "<i class='fusiona-minus'>");
        }
        else if (state == 1) {
            $(ctrl).parent().find(".boxDetail").hide();
            $(ctrl).attr("data-state", "0");
            $(ctrl).html("Image Carousel Item " + index + "<i class='fusiona-plus2'>");
        }
    }

    function addNewImageCarousel(ctrl, obj) {
        //var table = $(ctrl).parents("table:first").attr("id");
        ////alert($(table).html());
        //var tr = $("#" + table + " tr:first");
        //var cloneTr = $(tr).clone(true);
        //$(tr).after($(cloneTr));

        var tr = $(ctrl).parents("tr:first");
        var prevTr = $(tr).prev()[0];
        var cloneTr = $(prevTr).clone(true);
        $(cloneTr).css("display", "");
        $(cloneTr).addClass("child-clone-row");
        var td = $(cloneTr).find("td:first");
        var linkHeader = $(td).find(".linkHeader");
        ImageCarousel += 1;
        $(linkHeader).attr("data-boxIndex", ImageCarousel);
        $(linkHeader).html("Image Carousel Item " + ImageCarousel + "<i class='fusiona-plus2'>");
        cloneTr.find(".fusionb-upload-button").prop('id', 'imageCarouselUpload' + ImageCarousel);
        //$(linkHeader).attr("data-state", ImageCarouselImageCarousel);


        cloneTr.find('#imageCarouselUpload' + ImageCarousel).click(function () {
            $("#dialog_uploadMedia").empty();
            var template = root + "/Templates/CMS/Editor/UploadMediaTemplate.html";
            $("#dialog_uploadMedia").load(template);
            uploaderOpenedBy = $(this);

            if (uploaderOpenedBy.hasClass('remove-image')) {
                uploaderOpenedBy.parent().find('img').attr('src', '');
                uploaderOpenedBy.parent().find('input').attr('value', '');
                uploaderOpenedBy.hide();
                uploaderOpenedBy.text('Upload').removeClass('remove-image').attr('style', '');

                return;
            }
            //$("#dialog_uploadMedia").attr("data-allowMultiSelect",false); //Add this line only if you want to add multiselect option
            var dialog = $("#dialog_uploadMedia").dialog({
                autoOpen: false,
                width: "96%",
                modal: true,
                resizable: false,
                position: [30, 30],
                dialogClass: "no-titlebar",
                create: function (event) { $(event.target).parent().css('position', 'fixed'); $(".ui-widget-header").hide(); },
                open: function () { $(".ui-widget-header").hide(); },
                close: function () {                    
                    $(".ui-widget-header").show();
                    if (selectedUploadedObjectsToUse.length > 0) {
                        uploaderCallback(selectedUploadedObjectsToUse[0].FilePath);
                        uploaderOpenedBy.text('Remove').addClass('remove-image');
                    }                    
                }
            });
            dialog.dialog("open");
        });

        if (obj != undefined) {
            $(cloneTr).find(".subObjectProperty").each(function () {
                if ($(this).is('div')) {
                    $(this).html(obj[$(this).attr("data-subPropertyIndex")]);
                } else {
                    $(this).val(obj[$(this).attr("data-subPropertyIndex")]);
                }
            });
            $(cloneTr).find(".uploaded-image").each(function () {
                $(this).attr("src", obj[70]);
                if (obj[70] != '') {
                    $(this).parent().find('.fusionb-upload-button').text('Remove').addClass('remove-image');
                }
            });
        }
        $(prevTr).before($(cloneTr));
    }

    function removeImageCarousel(ctrl) {
        var tr = $(ctrl).parents("tr:first");
        if (ImageCarousel == 1) {
            alert("You need a minimum of one row");
            return false;
        }
        $(tr).remove();
        ImageCarousel -= 1;
        var c = 1;
        $("#ImageCarouselContainer tr.child-clone-row").each(function () {
            var linkHeader = $(this).find(".linkHeader");
            $(linkHeader).attr("data-boxIndex", c);
            $(linkHeader).html("Image Carousel Item " + c + "<i class='fusiona-plus2'>");
            c = c + 1;
        });
    }

    function createObjects(ctrl) {

    }

    function uploaderCallback(filePath) {
        if ($(uploaderOpenedBy) != undefined) {
            $(uploaderOpenedBy).parent().find("input[type='hidden']").val(filePath);
            $(uploaderOpenedBy).parent().find("img").attr("src", filePath);
        }
    }
</script>