<style>
    .colorSelector {
        position: relative;
        width: 36px;
        height: 36px;
    }

        .colorSelector div {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 30px;
            height: 30px;
        }

    .colorpicker {
        z-index: 1120;
    }
</style>
<script>
    var counter = 0;
    var textareaID;
    //tinymce.remove();
    var uploaderOpenedBy = {};

    $(document).ready(function () {
        $('#colorSelector div').css('backgroundColor', '#ffffff');

        //get the object and set values
        var carrierObj = JSON.parse($("#dialog_form").attr("data-obj"));
        try {
            $(".objectProperty").each(function () {
                if ($(this).is('div')) {
                    $(this).html(carrierObj[$(this).attr("data-PropertyIndex")]);
                } else {
                    if (carrierObj[$(this).attr("data-PropertyIndex")] != null && carrierObj[$(this).attr("data-PropertyIndex")] != undefined && carrierObj[$(this).attr("data-PropertyIndex")].length > 0)
                        $(this).val(carrierObj[$(this).attr("data-PropertyIndex")]);
                }
            });
        } catch (e) {
        }
        //set color
        $('#backgroundColorSelector div').css('backgroundColor', $('#backgroundColor').val());
        $('#borderColorSelector div').css('backgroundColor', $('#borderColor').val());
        $('#inactiveColorSelector div').css('backgroundColor', $('#inactiveColor').val());
        $('#linkTextColorSelector div').css('backgroundColor', $('#linkTextColor').val());

        $('#linkTextColorSelector').ColorPicker({
            color: '#000000',
            onShow: function (colpkr) {
                $(colpkr).fadeIn(500);
                return false;
            },
            onHide: function (colpkr) {
                $(colpkr).fadeOut(500);
                return false;
            },
            onChange: function (hsb, hex, rgb) {
                $('#linkTextColorSelector div').css('backgroundColor', '#' + hex);
                $('#linkTextColor').val('#' + hex);
            }
        });

        $('#backgroundColorSelector').ColorPicker({
            color: '#000000',
            onShow: function (colpkr) {
                $(colpkr).fadeIn(500);
                return false;
            },
            onHide: function (colpkr) {
                $(colpkr).fadeOut(500);
                return false;
            },
            onChange: function (hsb, hex, rgb) {
                $('#backgroundColorSelector div').css('backgroundColor', '#' + hex);
                $('#backgroundColor').val('#' + hex);
            }
        });

        $('#borderColorSelector').ColorPicker({
            color: '#000000',
            onShow: function (colpkr) {
                $(colpkr).fadeIn(500);
                return false;
            },
            onHide: function (colpkr) {
                $(colpkr).fadeOut(500);
                return false;
            },
            onChange: function (hsb, hex, rgb) {
                $('#borderColorSelector div').css('backgroundColor', '#' + hex);
                $('#borderColor').val('#' + hex);
            }
        });

        $('#inactiveColorSelector').ColorPicker({
            color: '#000000',
            onShow: function (colpkr) {
                $(colpkr).fadeIn(500);
                return false;
            },
            onHide: function (colpkr) {
                $(colpkr).fadeOut(500);
                return false;
            },
            onChange: function (hsb, hex, rgb) {
                $('#inactiveColorSelector div').css('backgroundColor', '#' + hex);
                $('#inactiveColor').val('#' + hex);
            }
        });

        $(".ui-dialog").css("height", $(window).height() - 70);

        $("#tabBoxContainer tr:first").hide();
        var tempContentBoxes = carrierObj[691];
        if (tempContentBoxes != undefined && tempContentBoxes.length > 0) {
            for (var i = 0; i < tempContentBoxes.length; i++) {
                addNewTabBox($("#fusion-child-add"), tempContentBoxes[i]);
            }
        } else {//First Time
            addNewTabBox($("#fusion-child-add"));
        }
    });

    function toggleTabBoxDetail(ctrl) {
        var state = $(ctrl).attr("data-state");
        var index = $(ctrl).attr("data-boxIndex");

        if (state == 0) {
            $(ctrl).parent().find(".boxDetail").show();
            $(ctrl).attr("data-state", "1");
            $(ctrl).html("Link Button " + index + "<i class='fusiona-minus'>");
        }
        else if (state == 1) {
            $(ctrl).parent().find(".boxDetail").hide();
            $(ctrl).attr("data-state", "0");
            $(ctrl).html("Link Button " + index + "<i class='fusiona-plus2'>");
        }
    }

    function addNewTabBox(ctrl, obj) {

        var tr = $(ctrl).parents("tr:first");
        var prevTr = $(tr).prev()[0];
        var cloneTr = $(prevTr).clone(true);
        $(cloneTr).css("display", "");
        $(cloneTr).addClass("child-clone-row");
        var td = $(cloneTr).find("td:first");
        var linkHeader = $(td).find(".linkHeader");

        counter += 1;
        $(linkHeader).attr("data-boxIndex", counter);
        $(linkHeader).html("Link Button " + counter + "<i class='fusiona-plus2'>");
        cloneTr.find(".fusionb-upload-button").prop('id', 'testimonialBoxUpload' + counter);
        if (obj != undefined) {
            $(cloneTr).find(".subObjectProperty").each(function () {
                if ($(this).is('div')) {
                    $(this).html(obj[$(this).attr("data-subPropertyIndex")]);
                } else {
                    $(this).val(obj[$(this).attr("data-subPropertyIndex")]);
                }
            });
            $(cloneTr).find(".uploaded-image").each(function () {
                $(this).attr("src", obj[101]);
                if (obj[101] != '') {
                    $(this).parent().find('.fusionb-upload-button').text('Remove').addClass('remove-image');
                }
            });
        }

        $(cloneTr).find('#testimonialBoxUpload' + counter).click(function () {
            $("#dialog_uploadMedia").empty();
            var template = root + "/Templates/CMS/Editor/UploadMediaTemplate.html";
            $("#dialog_uploadMedia").load(template);
            uploaderOpenedBy = $(this);
            if (uploaderOpenedBy.hasClass('remove-image')) {
                uploaderOpenedBy.parent().find('img').attr('src', '');
                uploaderOpenedBy.parent().find('input').attr('value', '');
                uploaderOpenedBy.hide();
                uploaderOpenedBy.text('Upload').removeClass('remove-image').attr('style', '');

                return;
            }
            var dialog = $("#dialog_uploadMedia").dialog({
                autoOpen: false,
                width: "96%",
                modal: true,
                resizable: false,
                position: [30, 30],
                dialogClass: "no-titlebar",
                create: function (event) { $(event.target).parent().css('position', 'fixed'); $(".ui-widget-header").hide(); },
                open: function () { $(".ui-widget-header").hide(); },
                close: function () {
                    $(".ui-widget-header").show();
                    if (selectedUploadedObjectsToUse.length > 0) {
                        uploaderCallback(selectedUploadedObjectsToUse[0].FilePath);
                        uploaderOpenedBy.text('Remove').addClass('remove-image');
                    }
                }
            });
            dialog.dialog("open");
        });

        $(prevTr).before($(cloneTr));
    }

    function removeTabBox(ctrl) {
        var tr = $(ctrl).parents("tr:first");
        if (counter == 1) {
            alert("You need a minimum of one row");
            return false;
        }
        $(tr).remove();
        counter -= 1;
        var c = 1;
        $("#tabBoxContainer tr.child-clone-row").each(function () {
            var linkHeader = $(this).find(".linkHeader");
            $(linkHeader).attr("data-boxIndex", c);
            $(linkHeader).html("Tab Boxes Item " + c + "<i class='fusiona-plus2'>");
            c = c + 1;
        });
    }

    function uploaderCallback(filePath) {
        if ($(uploaderOpenedBy) != undefined) {
            $(uploaderOpenedBy).parent().find("input[type='hidden']").val(filePath);
            $(uploaderOpenedBy).parent().find("img").attr("src", filePath);
        }
    }
</script>
<div style="width: 95%; display: inline-block; position: absolute; left: 2%">
    <div class="clearfix form-element-container form-element-container-color">
        <div class="name-description"><strong>Background Color</strong><span>Controls the background color. Leave blank for theme option selection.</span></div>
        <div class="element-type">
            <div class="wp-picker-container">
                <table style="width: 100%" colspacing="10">
                    <tr>
                        <td style="width: 75%; text-align: right;">
                            <div id="backgroundColorSelector" class="colorSelector" style="width: 90%;">
                                <div style="width: 75%; border: 1px solid black; cursor: pointer; text-align: center; font-weight: bold; border-right: none;">
                                </div>
                                <span style="width: 25%; border: 1px solid black; float: right; vertical-align: middle; height: 25px; border-left: none; cursor: pointer; text-align: center; padding-top: 5px; font-weight: bold; display: inline-block; background-color: #F0F0F0; position: relative; top: 3px; left: 3px;">Select Color
                                </span>
                            </div>
                        </td>
                        <td style="width: 25%; vertical-align: middle;">
                            <input type="text" class="objectProperty" data-propertyindex="685" value="#ededed" id="backgroundColor" name="backgroundColor" size="50" style="padding: 6px 0px !important; text-align: center;">
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>



    <div class="clearfix form-element-container form-element-container-color">
        <div class="name-description"><strong>Mobile Menu Background Color</strong><span>Controls the background color in mobile. Leave blank for theme option selection.</span></div>
        <div class="element-type">
            <div class="wp-picker-container">
                <table style="width: 100%" colspacing="10">
                    <tr>
                        <td style="width: 75%; text-align: right;">
                            <div id="inactiveColorSelector" class="colorSelector" style="width: 90%;">
                                <div style="width: 75%; border: 1px solid black; cursor: pointer; text-align: center; font-weight: bold; border-right: none;">
                                </div>
                                <span style="width: 25%; border: 1px solid black; float: right; vertical-align: middle; height: 25px; border-left: none; cursor: pointer; text-align: center; padding-top: 5px; font-weight: bold; display: inline-block; background-color: #F0F0F0; position: relative; top: 3px; left: 3px;">Select Color
                                </span>
                            </div>
                        </td>
                        <td style="width: 25%; vertical-align: middle;">
                            <input type="text" class="objectProperty" data-propertyindex="688" value="#000000" id="inactiveColor" name="inactiveColor" size="50" style="padding: 6px 0px !important; text-align: center;">
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div class="clearfix form-element-container form-element-container-color">
        <div class="name-description"><strong>Border Color</strong><span>Controls the color of the outer tab border. Leave blank for theme option selection.</span></div>
        <div class="element-type">
            <div class="wp-picker-container">
                <table style="width: 100%" colspacing="10">
                    <tr>
                        <td style="width: 75%; text-align: right;">
                            <div id="borderColorSelector" class="colorSelector" style="width: 90%;">
                                <div style="width: 75%; border: 1px solid black; cursor: pointer; text-align: center; font-weight: bold; border-right: none;">
                                </div>
                                <span style="width: 25%; border: 1px solid black; float: right; vertical-align: middle; height: 25px; border-left: none; cursor: pointer; text-align: center; padding-top: 5px; font-weight: bold; display: inline-block; background-color: #F0F0F0; position: relative; top: 3px; left: 3px;">Select Color
                                </span>
                            </div>
                        </td>
                        <td style="width: 25%; vertical-align: middle;">
                            <input type="text" class="objectProperty" data-propertyindex="686" value="" id="borderColor" name="borderColor" size="50" style="padding: 6px 0px !important; text-align: center;">
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <div class="clearfix form-element-container form-element-container-input">
        <div class="name-description"><strong>Border Width</strong><span>Custom setting. For custom alert boxes. In pixels (px), ex: 1px.</span></div>
        <div class="element-type">
            <input type="text" class="text-field objectProperty" data-propertyindex="687" value="" id="fusion_bordersize" name="fusion_bordersize" size="50" style="padding: 6px 0px !important;">
        </div>
    </div>
    <div class="clearfix form-element-container form-element-container-input">
        <div class="name-description"><strong>CSS Class</strong><span>Add a class to the wrapping HTML element.</span></div>
        <div class="element-type">
            <input type="text" class="text-field objectProperty" data-propertyindex="689" value="" id="fusion_class" name="fusion_class" size="50" style="padding: 6px 0px !important;">
        </div>
    </div>
    <div class="clearfix form-element-container form-element-container-input">
        <div class="name-description"><strong>CSS ID</strong><span>Add an ID to the wrapping HTML element.</span></div>
        <div class="element-type">
            <input type="text" class="text-field objectProperty" data-propertyindex="690" value="" id="fusion_id" name="fusion_id" size="50" style="padding: 6px 0px !important;">
        </div>
    </div>
    <table class="clearfix has-children" id="tabBoxContainer">
        <tbody>
            <tr data-boxindex="0">
                <td>
                    <a href="#" class="fusion-expand-child linkHeader" data-boxindex="1" onclick=" toggleTabBoxDetail(this) " data-state="0">Link Button 1<i class="fusiona-plus2"></i></a>
                    <div class="child-options boxDetail" style="display: none;" data-boxindex="1">
                        <div class="clearfix form-element-container funsion-element-child form-element-container-upload">
                            <div class="name-description"><strong>Link Image(50 X 40)</strong><span>Upload a link image.</span></div>
                            <div class="element-type">
                                <div class="fusion-upload-container">
                                    <img src="" alt="Image" class="uploaded-image" style="height: 50px; width: 40px; padding-bottom: 3px;">
                                    <div style="clear: both;"></div>
                                    <input type="hidden" class="fusion-form-text fusion-form-upload fusion-input subObjectProperty" name="fusion_image" value=""
                                        data-subpropertyindex="101">
                                    <a href="#" class="fusionb-upload-button " data-upid="1">Upload</a>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix form-element-container funsion-element-child form-element-container-select">
                            <div class="name-description"><strong>Image Position</strong><span>Choose the position of image respective to link text.</span></div>
                            <div class="element-type">
                                <div class="select_arrow"></div>
                                <select class="select-field subObjectProperty" data-subpropertyindex="102">
                                    <option value="left">Left</option>
                                    <option value="right">Right</option>
                                    <option value="top">Top</option>
                                    <option value="bottom">Bottom</option>
                                </select>
                            </div>
                        </div>
                        <div class="clearfix form-element-container funsion-element-child form-element-container-input">
                            <div class="name-description"><strong>Image Alt Text</strong><span>The alt attribute provides alternative information if an image cannot be viewed.</span></div>
                            <div class="element-type">
                                 <input type="text" class="text-field subObjectProperty" data-subpropertyindex="175" value="" id="txtAltText" name="fusion_name[0]" size="50" style="padding: 6px 0px !important;">
                            </div>
                        </div>

                        <div class="clearfix form-element-container funsion-element-child form-element-container-input">
                            <div class="name-description"><strong>Link Text</strong><span>Insert the link text</span></div>
                            <div class="element-type">
                                <input type="text" class="text-field subObjectProperty" data-subpropertyindex="103" value="" size="50" style="padding: 6px 0px !important;">
                            </div>
                        </div>
                        <div class="clearfix form-element-container funsion-element-child form-element-container-color">
                            <div class="name-description"><strong>Link Text Color</strong><span>Controls the text color. Leave blank for theme option selection.</span></div>
                            <div class="element-type">
                                <div class="wp-picker-container">
                                    <table style="width: 100%" colspacing="10">
                                        <tr>
                                            <td style="width: 75%; text-align: right;">
                                                <div id="linkTextColorSelector" class="colorSelector" style="width: 90%;">
                                                    <div style="width: 75%; border: 1px solid black; cursor: pointer; text-align: center; font-weight: bold; border-right: none;">
                                                    </div>
                                                    <span style="width: 25%; border: 1px solid black; float: right; vertical-align: middle; height: 25px; border-left: none; cursor: pointer; text-align: center; padding-top: 5px; font-weight: bold; display: inline-block; background-color: #F0F0F0; position: relative; top: 3px; left: 3px;">Select Color</span>
                                                </div>
                                            </td>
                                            <td style="width: 25%; vertical-align: middle;">
                                                <input type="text" class="objectProperty" data-propertyindex="104" value="#3589C4" id="linkTextColor" name="linkTextColor" size="50" style="padding: 6px 0px !important; text-align: center;">
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix form-element-container funsion-element-child form-element-container-input">
                            <div class="name-description"><strong>Link Target Id</strong><span>Insert the target div id for this link</span></div>
                            <div class="element-type">
                                <input type="text" class="text-field subObjectProperty" data-subpropertyindex="105" value="" size="50" style="padding: 6px 0px !important;">
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td><a id="fusion-child-add" data-itemcount="1" href="JavaScript:void(0)" onclick="addNewTabBox(this)">Add New Tab</a></td>
            </tr>
        </tbody>
    </table>
</div>
