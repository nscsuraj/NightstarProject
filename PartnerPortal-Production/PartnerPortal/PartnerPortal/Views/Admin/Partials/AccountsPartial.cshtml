
<style>
    
        .daycolodd {
            background-color: #D3ECFA;
            color: #133B7C;
        }

        .daycoleven {
            background-color: #ECF8FF;
            color: #133B7C;
        }




    @@media only screen and (max-width:1400px){
   
    }
    @@media only screen and (max-width:1150px){
    
    }
    @@media only screen and (max-width:940px){
  
    }
    @@media only screen and (max-width:900px) and (min-width:400px){
    
    }
    @@media only screen and (max-width:390px) and (min-width:0px){
   
    }
    .btnExport {
        width: 60%; 
        height: 30px; 
        color: #ffffff; 
        font-weight: normal; 
        display: inline-block; 
        text-align: center; 
        background-color: #133B7C; 
        font-size: 10pt;
        padding-top: 10px;
    }
    .oppHeaderCol1 {
        width: 50%;
        float: left;
        display: inline-block;
        text-align: left;
    }
    .oppHeaderCol2 {
        width: 47%;
        float: left;
        display: inline-block;
        text-align: right;
        margin-right: 10px;
    }
    .oppHeaderCol3 {
        float: right;
        text-align: right;
        display: inline-block;
        font-size: 11pt; font-weight: bold; letter-spacing: 1px;
    }
    .clsTextBoxLanding {
        width: 100% !important;
        border: 0 !important;
        border: 1px solid #73C4F2 !important;
        min-height: 30px !important;
        margin-top: 10px;
        padding-left: 15px; padding-right: 15px; box-sizing: border-box;
    }
    .clsTextBoxSearch {
        width: 300px !important;
        border: 0 !important;
        border: 1px solid #73C4F2 !important;
        min-height: 30px !important;
        margin-top: 10px;
        padding-left: 15px; padding-right: 15px; box-sizing: border-box;
    }
    .clsTextBoxOpportunity {
        width: 400px !important;
        border: 1px solid #969696 !important;
        min-height: 50px !important;
        margin-top: 10px;
        display: inline-block;
        padding-left: 15px; padding-right: 15px; box-sizing: border-box;
    }
    .bevelBox
    {
        width: 400px;
   
        background: #D3ECFA;
    
        border: 1px solid #D3ECFA;    
    
        -moz-box-shadow: inset 2px 2px 2px rgba(255, 255, 255, .4), inset 2px 2px 2px rgba(0, 0, 0, .4);
        -webkit-box-shadow: inset 2px 2px 2px rgba(255, 255, 255, .4), inset 2px 2px 2px rgba(0, 0, 0, .4);
        box-shadow: inset 2px 2px 2px rgba(255, 255, 255, .4), inset 2px 2px 2px rgba(0, 0, 0, .4);
        padding: 10px;
    }
    .statusChangeBox
    {
        width: 100px;
   
        background: #D3ECFA;
        color: #001E4F;
        height: 20px;
        border: 1px solid #D3ECFA;    
    
       -webkit-box-shadow: -1px 0px 30px -10px rgba(0,0,0,0.75);
        -moz-box-shadow: -1px 0px 30px -10px rgba(0,0,0,0.75);
        box-shadow: -1px 0px 30px -10px rgba(0,0,0,0.75);
        padding: 10px;
    }
     .oppTableHeader {
        padding: 2px; background-color: #ECF8FF; color: #001E4F; height: 30px; font-weight: bold; font-size: 12pt; table-layout: fixed;
    }
    .oppTableText {
        padding: 2px;padding-left: 5px; font-size: 10pt;
    }
    .tabColReseller {
        width: 120px;
    }
    .tabColDiscount {
        width: 170px;
    }
    .tabColPartnerNo {
        width: 140px;
    }
    .tabColPartDist {
        width: 170px;
    }
 @@media only screen and (max-width:1230px){
    .oppHeaderCol1 {
        width: 100%;
    }
    .oppHeaderCol2 {
        width: 100%;
        float: left;
        text-align: left;
    }
    .oppHeaderCol2  table{
        width: 280px !important;
        font-size: 14pt !important;
    }
}
  @@media only screen and (max-width:1650px){
        .oppTableHeader {
            font-size: 10pt;
        }
        .oppTableText {
            font-size: 10pt;
        }
        .tabColReseller {
            width: 100px;
        }
        .tabColDiscount {
            width: 130px;
        }
        .tabColPartnerNo {
            width: 120px;
        }
        .tabColPartDist {
            width: 130px;
        }
     }
     @@media only screen and (max-width:1420px){
        .oppTableHeader {
            font-size: 9pt;
        }
        .oppTableText {
            font-size: 10pt;
        }
        .tabColReseller {
            width: 100px;
        }
        .tabColDiscount {
            width: 120px;
        }
        .tabColPartnerNo {
            width: 120px;
        }
        .tabColPartDist {
            width: 120px;
        }
     }
     @@media only screen and (max-width:1300px){
        .oppTableHeader {
            font-size: 8pt;
        }
        .oppTableText {
            font-size: 9pt;
        }
        .tabColReseller {
            width: 75px;
        }
        .tabColDiscount {
            width: 105px;
        }
        .tabColPartnerNo {
            width: 85px;
        }
        .tabColPartDist {
            width: 105px;
        }
     }
     @@media only screen and (max-width:1100px){
        .oppTableHeader {
            font-size: 7pt;
        }
        .oppTableText {
            font-size: 8pt;
        }
        .tabColReseller {
            width: 65px;
        }
        .tabColDiscount {
            width: 92px;
        }
        .tabColPartnerNo {
            width: 75px;
        }
        .tabColPartDist {
            width: 92px;
        }
     }
@@media only screen and (max-width:990px){
    .btnExport {
        width: 60%; 
        height: 30px; 
        color: #ffffff; 
        font-weight: normal; 
        display: inline-block; 
        text-align: center; 
        background-color: #133B7C; 
        font-size: 10pt;
        padding-top: 0px;
    }
      .oppTableHeader {
            font-size: 6pt;
        }
        .tabColDiscount {
            width: 80px;
        }
        .tabColPartDist {
            width: 80px;
        }
        .tabColPartnerNo {
            width: 65px;
        }
}
     @@media only screen and (max-width:900px) and (min-width:811px){
        .oppTableHeader {
            font-size: 12pt;
        }
        .oppTableText {
            font-size: 10pt;
        }
        .tabColReseller {
            width: 120px;
        }
        .tabColDiscount {
            width: 160px;
        }
        .tabColPartnerNo {
            width: 140px;
        }
        .tabColPartDist {
            width: 160px;
        }
    }
    @@media only screen and (max-width:810px) and (min-width:700px){
        .oppTableHeader {
            font-size: 11pt;
        }
        .oppTableText {
            font-size: 10pt;
        }
        .tabColReseller {
            width: 105px;
        }
        .tabColDiscount {
            width: 145px;
        }
        .tabColPartnerNo {
            width: 111px;
        }
        .tabColPartDist {
            width: 145px;
        }
    }
    @@media only screen and (max-width:699px) and (min-width:611px){
        .oppTableHeader {
            font-size: 10pt;
        }
        .oppTableText {
            font-size: 10pt;
        }
        .tabColReseller {
            width: 85px;
        }
        .tabColDiscount {
            width: 120px;
        }
        .tabColPartnerNo {
            width: 100px;
        }
        .tabColPartDist {
            width: 120px;
        }
    }
    @@media only screen and (max-width:610px) and (min-width:530px){
        .oppTableHeader {
            font-size: 8pt !important;
        }
        .oppTableText {
            font-size: 10pt;
        }
        .tabColReseller {
            width: 75px;
        }
        .tabColDiscount {
            width: 105px;
        }
        .tabColPartnerNo {
            width: 85px;
        }
         .tabColPartDist {
            width: 95px;
        }
    }
    @@media only screen and (max-width:529px) and (min-width:490px){
        .oppTableHeader {
            font-size: 7pt !important;
        }
        .oppTableText {
            font-size: 8pt !important;
        }
        .tabColReseller {
            width: 65px;
        }
        .tabColDiscount {
            width: 95px;
        }
        .tabColPartnerNo {
            width: 80px;
        }
        .tabColPartDist {
            width: 85px;
        }
    }
    @@media only screen and (max-width:489px) and (min-width:0px){
        .oppTableHeader {
            font-size: 5.5pt !important;
        }
        .oppTableText {
            font-size: 7pt !important;
        }
        .tabColReseller {
            width: 55px;
        }
        .tabColDiscount {
            width: 73px;
        }
        .tabColPartnerNo {
            width: 60px;
        }
        .tabColPartDist {
            width: 67px;
        }
        #displayOpportunityList {
            padding: 0px !important;
        }
    }
</style>

<div style="width: 100%;" ng-controller="StarDistResellersController">
    <div class="fusion-fullwidth fullwidth-box" style="text-align: left; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover; background-size: cover;">

        <div class="fusion-row" id="displayResellers">
            <div style="width: 100%; display: inline-block; text-align: left; padding-top: 30px; color: #3D80EB;">
                <div style="width: 100%; height: 30px; color: #2551A4; margin-top: 40px; font-size: 22pt; font-weight: bold;">
                    Accounts Administration
                </div>
@*                <div style="width: 100%; height: 30px; color: #2551A4; font-size: 12pt; font-weight: normal;">
                    Partners who you currently have business with are listed below.
                </div>*@
                <div class="oppHeaderCol1" style="margin-top: 20px;">
                    <div style="width: 100%; color: #2551A4; font-size: 12pt;">Search by Account Name</div>
                    <div style="width: 100%; float: left; display: table-cell; vertical-align: middle;">
                        <input class="clsTextBoxSearch" id="filter" placeholder="&#128269;" type="text" value="" ng-model="filterName">
                    </div>
                </div>
                @*<div class="oppHeaderCol2" style="margin-top: 20px; display: none;">
                    <div style="width: 100%; color: #2551A4; font-size: 12pt;">&nbsp;</div>
                    <div style="width: 100%; float: left; display: table-cell; vertical-align: middle;">
                        <table style="width: 100%;">
                            <tr style="color:#8C9D41">
                                <td style="font-size: 14pt !important; font-weight: bold; letter-spacing: 1px;">Distributor Discount</td>
                                <td style="width: 50px; height: 40px; background-color: #D3ECFA; text-align: center;font-size: 14pt !important; font-weight: bold; letter-spacing: 1px;">{{Account.DistributorDiscount}}</td>
                            </tr>
                        </table>
                    </div>
                </div>*@

            </div>
            <div style="width: 100%; display: inline-block; text-align: left; padding-top: 30px; color: #3D80EB;">
               @* <div style="width: 50%; padding-left: 15px; float: left;">
                    <div style="width: 100%; color: #2551A4; font-weight: bold; font-size: 12pt;">Effective date : {{TodayDate}}</div>
                </div>*@
                <div style="width: 30%; padding-left: 15px;padding-right: 25px; float: right; text-align: right;">
                    <div class="btnExport" ng-click="exportExcel()" style="cursor: pointer;">Export</div>
                     <button ng-json-export-excel data="AccountListToExport" report-fields="ColumnList" optional-Texts ="disclaimerList" filename="'Accounts'" style="display: none;" id="btnExport">Export Excel</button>
                </div>
            </div>
            <div id="displayOpportunityList" style="padding: 10px; text-align: center;">
                <table style="cursor: pointer; text-align: left; width: 100%; table-layout: fixed; word-wrap: break-word;">
                    <thead>
                        <tr style="text-align: left; border-bottom: 1px solid #000000;">
                            <th class="oppTableHeader tabColDiscount" style="padding-left: 5px;">Account Id</th>
                            <th class="oppTableHeader" style="padding-left: 5px;">Account Name</th>
                            <th class="oppTableHeader tabColReseller">Status</th>
                            <th ng-click="predicate = 'OpportunityName'; reverse=!reverse" class="oppTableHeader tabColDiscount">Password Reset</th>
                            <th ng-click="predicate = 'OpportunityName'; reverse=!reverse" class="oppTableHeader tabColPartDist">Date Created</th>
                            <th class="oppTableHeader tabColPartnerNo" style="text-align: left;">Last Login</th>
                            <th class="oppTableHeader tabColReseller" style="text-align: left;">Loyalty Data</th>
                        </tr>
                    </thead>
                    <tbody>
                    <tr ng-show="showLoading">
                        <td colspan="4">
                            <div style="font-size: 16pt; font-weight: bold; color: #737373; margin-left: 15px; margin-bottom: 20px; border: 1px solid #ececec; text-align: center;">
                                <img src="~/Images/loadingP.gif"/>
                            </div>

                        </td>
                    </tr>
                    <tr dir-paginate-start="item in AccountList | filter : {AccountName : filterName} | orderBy : predicate:reverse|itemsPerPage:10" ng-hide="showLoading">
                        <td style="height: 10px; padding: 0; font-size: 4pt; background-color: #ECF8FF;" colspan="4">&nbsp;</td>
                    </tr>
                    <tr style="background-color: #D3ECFA; color: #001E4F; height: 30px;">
                        <td class="oppTableText" style="padding-left: 5px;">{{item.AccountId}}</td>
                        <td class="oppTableText" style="padding-left: 5px;">{{item.AccountName}}</td>
                        <td class="oppTableText" style="padding-left: 5px; padding: 0; vertical-align: top;" ng-mouseover="ShowStatusChangeBox = true" ng-mouseout="ShowStatusChangeBox = false">
                            <div class="statusChangeBox" style="z-index: 99899; height: 50px; position: absolute;" ng-show="ShowStatusChangeBox">
                                <table>
                                    <tr>
                                        <td>
                                            {{item.Status ? 'Active': 'Deactive'}}
                                        </td>
                                        <td style="vertical-align: middle; padding-left: 4px; text-align: right;">
                                            <img style="width: 10px; height: 8px;" src="@Url.Content("~/Images/downArrow.png")" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2" ng-click="ChangeStatus(item)">
                                            {{item.Status ? 'Deactivate': 'Activate'}}
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <table ng-hide="ShowStatusChangeBox">
                                <tr>
                                    <td>
                                        {{item.Status ? 'Active': 'Deactive'}}
                                    </td>
                                    <td style="vertical-align: middle; padding-left: 4px; text-align: right;">
                                        <img style="width: 10px; height: 8px;" src="@Url.Content("~/Images/downArrow.png")" />
                                    </td>
                                </tr>
                                @* <tr>
                    <td>
                        {{getDisplayStatus(item)}}
                    </td>
                    <td style="vertical-align: middle; padding-left: 4px; text-align: right;">
                        <img style="width: 10px; height: 8px; " src="@Url.Content("~/Images/downArrow.png")"/>
                    </td>
                </tr>*@
                            </table>

                        </td>
                        <td class="oppTableText" style="padding-left: 5px; font-weight: bold;">
                            <div ng-click="SendPasswordResetLink(item)">Send Now ></div>
                        </td>
                        <td class="oppTableText" style="padding: 5px;">{{item.DateCreated}}</td>
                        <td class="oppTableText" style="padding: 5px; text-align: left;">{{item.LastLogin}}</td>
                        <td class="oppTableText" style="padding-left: 5px; font-weight: bold;">
                            <div ng-click="ClearLoyaltyData(item)" ng-show="item.HasLoyaltyData">Clear Data ></div>
                        </td>
                    </tr>
                    <tr dir-paginate-end>
                        <td style="height: 1px; padding: 0; font-size: 0pt; background-color: #ECF8FF;" colspan="4"></td>
                    </tr>

                    </tbody>
                </table>
                <dir-pagination-controls max-size="5" direction-links="true" boundary-links="true"></dir-pagination-controls>
            </div>
           

        </div>
        <div style="width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000001; position: fixed; left: 0; top: 0;" ng-show="ShowProcessing">
            <div style="width: 200px; height: 200px; background-color: #ffffff; margin-left: 50%; margin-top: 24%; box-shadow: 5px 10px 10px #000000; overflow-y: hidden;">
                <img src="@Url.Content("~/Images/processing10.gif")" />
            </div>
        </div>

    </div>

</div>


<Style>
    

    @@media only screen and (max-width: 759px) {


    }

    @@font-face {
        font-family: 'Sintony';
        font-style: normal;
        font-weight: 400;
        src: local('Sintony'), url(https://fonts.gstatic.com/s/sintony/v7/XoHm2YDqR7-98cVUET0tuv0rnjrQ8Q.woff2) format('woff2');
        unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }
    /* latin */
    @@font-face {
        font-family: 'Sintony';
        font-style: normal;
        font-weight: 400;
        src: local('Sintony'), url(https://fonts.gstatic.com/s/sintony/v7/XoHm2YDqR7-98cVUETMtuv0rnjo.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }


  
</Style>

<script>
     

        app.controller("StarDistResellersController", function ($controller, $scope, $http, $sce, 
            notificationFactory, $location,
            validationFactory, filterFilter, helperFactory, dbUtilFactory) {
            $scope.AccountList = [];
            $scope.AccountListToExport = [];
            $scope.ShowStatusChangeBox = false;
            $scope.ShowProcessing = false;
            $scope.disclaimerList = [];
            $scope.disclaimerLine = "";

            $scope.getTime = function () {
                var d = new Date();
                d.setHours(d.getHours()); // offset from local time
                var h = (d.getHours() % 12) || 12; // show midnight & noon as 12
                return (
                    (h < 10 ? '0' : '') + h +
                    (d.getMinutes() < 10 ? ':0' : ':') + d.getMinutes() +
                    (d.getHours() < 12 ? ' AM' : ' PM')
                );

            }

            $scope.getAccountList = function() {
                dbUtilFactory.get(root + 'api/ppcmsapi/GetAccountsForAdminDashboard/', "", function (d) {
                    $scope.AccountList = d;
                    $scope.AccountListToExport = d;
                    $scope.showLoading = false;

                    $scope.disclaimerLine = "(c) " + (new Date()).getFullYear() + " Star Micronics America. All rights reserved.";
                    $scope.disclaimerList.push({ description: $scope.disclaimerLine });
                    $scope.disclaimerLine = "Confidential Information - Do Not Distribute.";
                    $scope.disclaimerList.push({ description: $scope.disclaimerLine });
                    $scope.disclaimerLine = "Generated By: Admin " + ((new Date()).getMonth() + 1) + "/" + (new Date()).getDate() + "/" + (new Date()).getFullYear() + " " + $scope.getTime();
                    $scope.disclaimerList.push({ description: $scope.disclaimerLine });
                }, '', 'Error getting data ');
            };
            $scope.getAccountList();

            $scope.ChangeStatus = function (acc) {
                var text = "Do you want to " + (acc.Status ? "Deactivate" : "Activate") + " " + acc.AccountName;
                var text1 = (acc.Status ? "Deactivated" : "Activated");
                var text2 = acc.AccountName + " has been " + text1;
                
                swal({
                    title: "Are you sure?",
                    text: text,
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "Change Status.",
                    closeOnConfirm: true,
                    closeOnCancel: true
                }).then(function () {
                    $scope.ShowProcessing = true;
                    dbUtilFactory.postp(root + 'api/ppcmsapi/ChangeAccountStatus/', acc, function () {
                        swal(
                            text1,
                            text2,
                            'success'
                        );
                        $scope.getAccountList();
                        $scope.ShowProcessing = false;
                    }, '', 'Error getting data ');
                });
            }

            $scope.ClearLoyaltyData = function (acc) {
                var text = "Do you want to clear loyalty registration info saved locally for " + acc.AccountName;

                swal({
                    title: "Are you sure?",
                    text: text,
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "Clear Data",
                    closeOnConfirm: true,
                    closeOnCancel: true
                }).then(function () {
                    $scope.ShowProcessing = true;
                    dbUtilFactory.postp(root + 'api/ppcmsapi/ClearLoyaltyData/', acc, function () {
                        swal(
                            "Deleted",
                            "Loyalty data deleted",
                            'success'
                        );
                        $scope.getAccountList();
                        $scope.ShowProcessing = false;
                    }, '', 'Error getting data ');
                });
            }

            
            $scope.SendPasswordResetLink = function (acc) {
                var url = root + 'Gateway/SendResetPasswordLink/?email=' + acc.AccountEmail;
                $scope.ShowProcessing = true;

                dbUtilFactory.get(url, "", function (d) {
                    $scope.ShowProcessing = false;
                    //  alert($scope.ShowProcessing);
                    if (d === "Done") {
                        swal({
                            title: "Done",
                            text: "Reset link sent.",
                            type: "success"
                        });
                    } else {
                        swal({
                            title: "Error",
                            text: d,
                            type: "error"
                        });
                    }

                }, '', 'Error getting data ');
            }

            $scope.ColumnList = { AccountName: 'Account Name', StatusDisplay: "Status", DateCreated: "Date Created", LastLogin: 'Last Login' };

            $scope.exportExcel = function () {
                document.getElementById('btnExport').click();
            }

            $scope.$watch('filterName', function (newVal, oldVal, scope) {
                var query = $("#filter").val();
                if (query != undefined && query != "") {
                    var temp = [];
                    for (var i = 0; i < $scope.AccountList.length; i++) {
                        if (($scope.AccountList[i].AccountName != null) && (angular.lowercase($scope.AccountList[i].AccountName).indexOf(angular.lowercase(query) || '') !== -1)) {
                            temp.push($scope.AccountList[i]);
                        }
                    }
                    $scope.AccountListToExport = temp;

                } else {
                    $scope.AccountListToExport = $scope.AccountList;
                }
            });
        });
    </script>
